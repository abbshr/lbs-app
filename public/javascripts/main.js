// Generated by CoffeeScript 1.9.3
(function() {
  var info, mapInitialize, postNewInfo;

  info = function(lng, lat, accuracy) {
    return "当前位置: (" + lng + ", " + lat + "), 精确度: " + accuracy + "\n";
  };

  mapInitialize = function(mapContainerId, lng, lat, zoom) {
    var map, pos;
    pos = new AMap.LngLat(lng, lat);
    return map = new AMap.Map(mapContainerId({
      view: new AMap.View2D({
        center: pos,
        zoom: zoom,
        rotation: 0
      }, {
        lang: "zh_cn"
      })
    }));
  };

  postNewInfo = function(form) {
    var formdata;
    formdata = new FormData(form);
    return fetch("/post", {
      method: 'POST',
      body: formdata
    });
  };

  window.onload = function(e) {
    $('#post-btn').click(function(e) {
      return $('#new-post').modal({
        blurring: true,
        onApprove: function() {
          $('#loader').addClass("active");
          setTimeout(function() {
            $('#new-post').modal('hide');
            return $('#loader').removeClass("active");
          }, 3000);
          return false;
        }
      }).modal('show');
    });
    this.geo = new Geo;
    return this.geo.getCurrent(function(pos) {
      mapInitialize("map", pos.longitude, pos.latitude, 13);
      return console.log(info(pos.longitude, pos.latitude, pos.accuracy));
    });
  };

}).call(this);
